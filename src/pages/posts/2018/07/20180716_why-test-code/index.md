---
templateKey: blog-post
title: TDDとかBDDとかあるけど、個人的に感じているテストコードを書く7つの理由
slug: /2018/07/16/why-test-code
createdAt: 2018-07-16 10:38:15
updatedAt: 2018-09-02 13:09:21
thumbnail: /2018/07/20180716_why-test-code/thumbnail.jpg
categories:
  - column
  - engineering
tags:
  - dummy
related:
  - dummy
---

&nbsp;

テストコードといえば、テストコードが必要か必要でないかというのはちょいちょい議論になるものではありますが、個人的には正しい開発を行う上では必ず必要になってくるものだと思っています。

唐突に自分の意見を書いてみましたが、

<strong>「じゃあなんで、テストコードを書くの？？？」</strong>

と聞かれるといくつかのメリットをあげることはできると思いますが、テストコードのない現場の忙しい開発者たちを相手にテストコード導入のメリットをあげて説得できるかというところにあまり自信が持てなかったのでテストコードを書くメリットを自分なりに整理してみました。

<div class="adsense"></div>

&nbsp;
<h2>当たり前だけどプログラムがちゃんと動いているかを効率的にチェックできる</h2>
&nbsp;

これは、まあ当たり前というかこれが達成されていなかったらテストコードのある意味がないですよね。

ただ現在のシステムで、作った後に手を加えないシステムというのはほぼないわけで、日々訪れる仕様変更や機能改善のためになんどもコードが書き換えられていきます。また、コードというのは保守期間やシステムの年齢に対して増大して行く傾向にあるので、最初は少人数でも品質を担保できていたコードがどんどん大きく複雑になり管理が難しくなってきます。

そんななかで、GUIベースでの統合的なテストとはいわずとも<strong>モジュールレベルで仕様通り動作しているかどうかをきっちり担保できていると日々の開発を進める上で大変心強いです。</strong>

サーバーから意図しないレスポンスが返ってくるのでみてみたところ、既存のバグでそれの調査と修正で予定した多くの工数をとられて、当初の見積もりをオーバーするとかいうのって本当にイライラしますよね。既存のコードが正しく動いていること（完璧にというのはなかな難しいですが）を担保できていない中での開発というのは非常にストレスがたまりますよね。

<strong>日々の開発を行なっている上で既存のバグが三つも四つも見つかるような現場ではテストコードの導入をオススメします。</strong>

&nbsp;
<h2>デプロイ作業が自動化できる</h2>
&nbsp;

これはシステムの品質というより作業工数の効率化観点ですが、<strong>テストコードである程度のカバレッジがないと自動デプロイって怖くてできないですよ。</strong>

静的型付けの言語とかであればよいですが、rubyやphpなど実際に動かしてみるまで構文エラーとかをすくえない言語では、本番でundefinedエラーなどのしょうもないエラーが起きてしまうのは嫌ですよね。テストコードで8割程度のカバレッジをもっておけば、デプロイの前に自動でテストが回るようにしてテストを通過した場合だけデプロイするという形でしょうもないエラーの多くを防ぐことができます。

テストがない状態でもデプロイの自動化はできますが、ちょっと怖くてできないですよね。。テストコードのないプロジェクトはこのように開発の運用にも影響を与えるので、きっちりテストを書く習慣をつけておきたいです。

&nbsp;
<h2>バージョンアップが楽になる</h2>
&nbsp;

テストコードがあるとバージョンアップが楽になります。バージョンアップする前には前バージョンとの変更点を確認して、修正してという流れになると思いますが、漏れとか怖いのでひとつずつ確認していきますよね。

そんな時にテストコードがあると完璧とはいかないまでも、人の打鍵では確認しづらい細かい部分までコードがバージョンアップの影響を受けていないか確認することができます。

まだ生まれたばかりのライブラリとかを使っていると結構バージョンアップの頻度が高く追従するのが難しかったりしますよね。かといって、古くなってしまったシステムをメンテナンスするのも嫌ですし、、、

<strong>テストコードを日頃から書いておくとバージョンアップする際には必ずテストコードのありがたみを感じることができるので、必ず報われることを信じながらテストコードを書いていきましょう。</strong>

&nbsp;
<h2>エンジニアとして一定の評価をされる</h2>
&nbsp;

フリーランスの面接でも割ともともとの現場のカバレッジを聞かれたりしたのですが、外からのみられ方としてテストコードがかける人なのか、<strong>テストコードを書く意義をわかっているかどうか</strong>というのはみられているように思います。

知り合いのフリーランスの方でも現場に入る前にそのプロジェクトのコードカバレッジがどれくらいか聞くそうです。テストコードのない現場だと、こっち直したらあっちが壊れてとかいうなかなか辛い状態での開発になるのでそういうのを警戒してあらかじめ開発環境が整っている環境かどうかというのは働く先での評価の基準になるようです。

転職の面接の際にも<strong>前職ではCIを導入していて、マスタマージと共に自動デプロイが走っていましたとかいうと「ちゃんとした現場で開発してきているな」という評価にはなると思います。</strong>

「テストコード０の現場からカバレッジを8割にしてCI環境を整備しました！」というほどでなくても、一エンジニアとしてテストコードをかける、書いた経験があるというのは非常に大事なことのように思います。

&nbsp;
<h2>コードがきれいになる</h2>
&nbsp;

テストコードを書いてみるとわかるのですが、コードにはテストの書きやすいコードと書きにくいコードが存在します。当然テストコードを書きやすいコードの方が好ましいわけですが、<strong>テストコードの書きにくいコードというのはだいたい一つのクラスやメソッド多くのことをやりすぎているコードです。</strong>

一つのメソッドであまりに多くのことをやろうとすると、人間の理解力を超越してコードを読むのが難しくなりますし、他のクラスへの依存も高まったり、重複の多いコードになりがちです。

これを防ぐために、テストの書きやすいコードを意識しながらコードを書くことができると単一責務を守った綺麗なコードができあがります。

<strong>テストの書きやすいコードというのが、自分でテストコードを書いていないと感覚がわかりづらいので、普段テストコードの書いていない人は今すぐにでもテストコードを書く習慣をつけられると良いと思います。</strong>

&nbsp;
<h2>リファクタしやすくなり、コードの質を保つ好循環が生まれる</h2>
&nbsp;

テストコードがあることによって既存のコードに手を入れてもテストコードがしっかり書いてあれば、自分では気づけない部分でテストがこけてくれて「あ、こっちも直さないといけないのか」となるので、リファクタ作業をするときも安心して作業をすすめることができます。

システム開発を進めているとどうしても納期に追われたりしてコードが汚くなっていきがちなのですが、<strong>テストコードがあるとリファクタへの心理的ハードルが下がるので、機能改修のついでのファクタなどができるようになってきて自然とシステム全体でのコードの質が保たれます。</strong>

ひとつずつテストコードを書いて行くの決して簡単な作業ではありませんが、ある程度カバレッジがあがってると上記のような好循環が作れるので、ぜひともテストコードの導入をオススメします。

&nbsp;
<h2>自分の書いたコードを見直す時間が作れる</h2>
&nbsp;

これは最近感じたのですが、テストコードを書く時というのは、プロダクトのコードをみながらコードを書いて行くので、自分の書いたコードをレビューしているよう状態になります。

自分で書いたコードって時間を置いてみると

<strong>「なんで、こんな酷いコードかいているんだろう？？」</strong>

と思うことありますよね。普段自分で仕事をしていて自分のコードを見直すことって意外となくて3ヶ月後とか半年後に同じ箇所に戻ってきて過去の自分の書いたコードで自己嫌悪に陥ったりするのですが、テストコードを書くことによってこれが短いスパンでできるようになります。

<strong>短いスパンで自分の過ちに気付けるので、次からコードを書く時にそこを気にしながら書くことができます。</strong>

これは自分がまだ未熟だからかもしれないのですが、コードって一発できれいなコードをかけるということが少なくて、一つの機能改善の中でも一度書いたものに納得がいかず再度書き直すなんてこともよくあります。

個人的には最初に書いたコードってどこか無駄があるので、それをまた書き直していくことでシンプルで無駄のないコードができあがると思っているので、書き直せば書き直すほど無駄のない筋肉質なシステムができあがるとも思っています。

なので、ひとつの開発の中で、
<ol>
 	<li>一旦動く形でコードを書いてみる</li>
 	<li>無駄な部分をリファクタする</li>
 	<li>テストコードを書きながら再度コードの見直し</li>
 	<li>納品物としてテストコードときれいに整頓されたシンプルなコードができる</li>
</ol>
みたいな順序を踏めると良いのではないでしょうか？（できる人は、1,2をまとめて一回でできてしまうのかもしれません。。というかテスト書きながらしっかり開発しているので全部一気にできるんですかね？？）

&nbsp;
<h2>まとめ</h2>
&nbsp;

以上私の考えるテストコードを書くメリットのまとめでした。
<ul class="list">
 	<li>当たり前かもしれないが、コードの挙動を効率的に確認することができる</li>
 	<li>デプロイ作業が自動化できる</li>
 	<li>バージョンアップが楽になる</li>
 	<li>エンジニアとして評価される</li>
 	<li>コードが綺麗になる</li>
 	<li>リファクタしやすくなり、コードの質を保つ好循環が生まれる</li>
 	<li>自分のかいたコードを見直す時間がつくれる</li>
</ul>
&nbsp;

まとめてみると、テストコードは現場的にデプロイの自動化で工数の削減ができたり、コードの質を担保できたりというチームよりなメリットもありますが、きれいなコードをかけるようになるとか自分の書いたコードを見直す時間が作れる、エンジニアとして評価されるなど個人的なメリットもあります。

テストコードに関しては、TDDだったら〜とかBDDだったら〜とか色々あるのかもしれませんが現時点個人的に感じているテストコードのメリットをまとめてみました。
